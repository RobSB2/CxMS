# CLAUDE.md

**CxMS Version:** 1.4
**Template Version:** 1.5
**Deployment Level:** Lite | Standard | Max
**Code Name:** [Optional - give your AI assistant a personality!]
**CxMS:** Agent Context Management System (https://github.com/RobSB2/CxMS)

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

<!-- Code Name Examples: Master Yoda (wise/patient), Luke Skywalker (action-ready),
     Obi-Wan Kenobi (diplomatic). Fun it is, required it is not. -->

---

## MANDATORY REQUIREMENTS

### Session Start Requirements

Before ANY work, you MUST:
1. Read this file completely
2. Read `[PROJECT]_Session.md` completely
3. Read `[PROJECT]_Tasks.md` completely
4. Provide verification summary to user

**After reading, you MUST provide:**
- Current active task (from Tasks.md)
- Last session date (from Session.md)
- What was done last session (from Session.md)
- Recommended next action

**If you cannot provide this summary, you have not read the required files.**

### CxMS Version & Health Check (On Session Start)

After providing the session summary, perform version and health checks:

**Version Check:**
1. Read the `CxMS Version` from this file
2. Fetch: `https://raw.githubusercontent.com/RobSB2/CxMS/main/templates/VERSIONS.md`
3. Compare versions - if local < remote, notify user:
   > "CxMS update available (vX.X → vY.Y). Would you like me to check what's new?"
4. If user accepts, follow `MIGRATION.md` update process

**Deployment Health Check:**
1. Read the `Deployment Level` from this file (Lite/Standard/Max)
2. Inventory which CxMS files exist in the project
3. Check for level-up signals (see `DEPLOYMENT.md` for criteria)
4. If upgrade recommended, notify user:
   > "Based on [signal], you might benefit from adding [file]. Would you like to upgrade to [level]?"

**Note:** If fetch fails (offline, etc.), skip version check silently and continue. Health check runs locally.

### Session End Requirements

Before ending OR when context compacts, you MUST:
1. Update `[PROJECT]_Session.md` with all changes
2. Update Session Metrics section (if tracking enabled)
3. Update `[PROJECT]_Tasks.md` if task status changed
4. Log any significant decisions in `[PROJECT]_Decision_Log.md` (if using)
5. Confirm update completion to user

### Context Monitoring (CRITICAL)

**On Session Start:**
- Note current context usage (if visible in UI)
- Be aware of "Context left until auto-compact" indicator

**During Session:**
- Monitor context consumption, especially during large file reads or complex tasks
- When context reaches ~75% full, alert user: "Context is getting full. Should we do a checkpoint save?"
- When context reaches ~90% full, STOP and perform pre-compaction save immediately

**Pre-Compaction Save Protocol:**
1. Immediately update `[PROJECT]_Session.md` with current state
2. List any work in progress with specific file:line references
3. Note any uncommitted decisions or pending items
4. Confirm save before continuing

**Why This Matters:** Auto-compaction preserves a summary but loses nuance. Proactive saves preserve full context.

### Mid-Session Requirements (if metrics tracking enabled)

After significant work packages:
1. Consider updating Session Metrics (compaction events, tasks completed)
2. Update Session.md if context is getting full
3. Do checkpoint saves at natural breakpoints in long sessions

### CxMS Health Check (Staleness Audit)

When requested or at session end, perform a staleness audit:

1. **Read all CxMS files** - Load current state of each
2. **Cross-reference data** - Check for inconsistencies:
   - Task status matches between Tasks.md and Session.md
   - File counts/deployments align across files
   - Activity log covers recent deployments
   - Session.md reflects current work
3. **Generate Status Report** - Table format with status and notes
4. **List Required Updates** - Specific issues to fix
5. **Offer to update** - "Want me to update these files?"

**Status Icons:**
- ✅ Current/OK - No action needed
- ⚠️ Stale/Inconsistent - Needs update
- ❌ Missing - File expected but not found

```
┌────────────────────────────────────────────────────────┐
│  BEFORE ENDING ANY SESSION OR COMPACTING:              │
│                                                        │
│  You MUST update [PROJECT]_Session.md                  │
│                                                        │
│  FAILURE TO DO THIS = LOST WORK                        │
└────────────────────────────────────────────────────────┘
```

### These requirements are NON-NEGOTIABLE
Failure to follow them results in lost work and wasted time.

---

## Output Preferences
<!-- Customize: Your preferences for AI output -->
Suppress showing any code in output unless explicitly asked.

## Overview
<!-- Replace with your project description -->
This is **[PROJECT NAME]**, a [brief description of what it does].

## Project Structure

| Directory | Purpose | Database |
|-----------|---------|----------|
| `src/` | Main source code | - |
| `tests/` | Test files | - |

## Tech Stack

- **Backend**: [Language] [Version], [Framework]
- **Frontend**: [Framework/Library]
- **Database**: [Type] [Version]
- **Build**: [Build tool if any]

## Key Files

- `[path/to/config]` - Configuration
- `[path/to/entry]` - Main entry point

## Database Connections
<!-- If applicable -->
Database credentials are in `[path/to/db/config]`.

## Development Commands

```bash
# Install dependencies
[command]

# Run development server
[command]

# Run tests
[command]

# Build for production
[command]
```

## Development Preferences
<!-- Your preferences for new code -->
- Prefer [X] over [Y] for [reason]
- New features should go in [directory]
- Follow [coding standard/style guide]

---

## Document Reading Order

For full context, read in this order:
1. This file (CLAUDE.md)
2. `[PROJECT]_Context.md` - Documentation index
3. `[PROJECT]_Session.md` - Current state
4. `[PROJECT]_Tasks.md` - What needs doing

For specific activities:
- **Planning:** Also read `[PROJECT]_Plan.md`, `[PROJECT]_Strategy.md`
- **Development:** Also read `[PROJECT]_Inventory.md`, `[PROJECT]_Exceptions.md`
- **Review:** Also read `[PROJECT]_Decision_Log.md`, `[PROJECT]_Activity_Log.md`

---

## Documentation Index

### Core Files (Required)
| File | Purpose | Update Frequency |
|------|---------|------------------|
| `CLAUDE.md` | Project overview (this file) | Rarely |
| `[PROJECT]_Context.md` | Documentation index | When docs change |
| `[PROJECT]_Session.md` | Current state | **Every session** |
| `[PROJECT]_Tasks.md` | Task tracker | As tasks change |
| `[PROJECT]_Prompt_History.md` | Audit trail | Each significant prompt |

### Log Files (Optional)
| File | Purpose | When to Use |
|------|---------|-------------|
| `[PROJECT]_Activity_Log.md` | What was done (deployments, DB changes) | Track significant actions |
| `[PROJECT]_Decision_Log.md` | Why decisions were made | Architectural choices |
| `[PROJECT]_Issue_Log.md` | Problems encountered | Debug patterns |
| `[PROJECT]_Session_Summary.md` | Quick session reference | Fast overview needed |
| `[PROJECT]_Deployment.md` | TEST/PROD status | Multi-environment |
| `[PROJECT]_Compaction_Log.md` | Context loss events | Debug context issues |
| `[PROJECT]_Performance_Log.md` | CxMS effectiveness metrics | Periodic review (30-60 days) |

### Project Documentation (Optional)
| File | Purpose | When to Use |
|------|---------|-------------|
| `[PROJECT]_Plan.md` | Multi-phase project plan | Large features |
| `[PROJECT]_Inventory.md` | Component listing | Complex codebases |
| `[PROJECT]_Strategy.md` | AI workflow docs | Long-running AI work |
| `[PROJECT]_Exceptions.md` | Technical workarounds | Edge cases exist |

---

## Document Version Control

| Document | Version | Last Updated | Last Verified |
|----------|---------|--------------|---------------|
| CLAUDE.md | 1.0 | [DATE] | [DATE] |
| Session.md | - | [dynamic] | [dynamic] |
| Tasks.md | - | [dynamic] | [dynamic] |

**Verification means:** AI read file and confirmed contents match project state
